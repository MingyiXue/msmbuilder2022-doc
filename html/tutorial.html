

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; MSMBuilder 3.8.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/msmb.css?v=51bd699f" />

  
      <script src="_static/documentation_options.js?v=fb7e056b"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/js/versions.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples/index.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/logo-200px.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="background.html">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="featurization.html">Featurization</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_selection.html">Feature Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="decomposition.html">Decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="cluster.html">Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="msm.html">Markov state models (MSMs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gmrq.html">Model Selection using GMRQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="tpt.html">Transition Path Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="ratematrix.html">Continuous-time MSMs</a></li>
<li class="toctree-l1"><a class="reference internal" href="hmm.html">Hidden Markov models (HMMs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="datasets.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="apipatterns.html">API Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Writing Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MSMBuilder</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Link to this heading">¶</a></h1>
<ol class="arabic">
<li><figure class="align-right" id="id2">
<img alt="_images/fspeptide.png" src="_images/fspeptide.png" />
<figcaption>
<p><span class="caption-text">Fs Peptide</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The command-line tool is <code class="docutils literal notranslate"><span class="pre">msmb</span></code>. Check that it’s installed correctly and
read the help options:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>msmb<span class="w"> </span>-h
</pre></div>
</div>
</li>
<li><p>In your own research, you probably have a large molecular dynamics
dataset that you wish to analyze. For this tutorial, we will perform a
quick analysis on a simple system: the Fs peptide.</p></li>
<li><p>We’ll use MSMBuilder to create a set of sample python scripts to sketch
out our project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>msmb<span class="w"> </span>TemplateProject<span class="w"> </span>-h<span class="w"> </span><span class="c1"># read the possible options</span>
msmb<span class="w"> </span>TemplateProject
</pre></div>
</div>
<p>This will generate a hierarchy of small scripts that will handle the
boilerplate and organization inherent in MSM analysis.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>.
├──<span class="w"> </span>analysis
│<span class="w">   </span>├──<span class="w"> </span>dihedrals
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>tica
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>cluster
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>msm
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>timescales.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>timescales-plot.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>microstate.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>microstate-plot.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>microstate-traj.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>cluster.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>cluster-plot.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>sample-clusters.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>sample-clusters-plot.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ftrajs<span class="w"> </span>-&gt;<span class="w"> </span>../ftrajs
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>tica.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>tica-plot.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>tica-sample-coordinate.py
│<span class="w">   </span>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>tica-sample-coordinate-plot.py
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>featurize.py
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>featurize-plot.py
│<span class="w">   </span>├──<span class="w"> </span>gather-metadata.py
│<span class="w">   </span>├──<span class="w"> </span>gather-metadata-plot.py
├──<span class="w"> </span><span class="m">0</span>-test-install.py
├──<span class="w"> </span><span class="m">1</span>-get-example-data.py
└──<span class="w"> </span>README.md
</pre></div>
</div>
<p>Each subsequent step in the MSM construction pipeline is a subdirectory.</p>
</li>
<li><p>Retrieve the Fs peptide example data by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span><span class="m">1</span>-get-example-data.py
</pre></div>
</div>
<p>Ensure that you now have a directory named <code class="docutils literal notranslate"><span class="pre">fs_peptide</span></code> with 28 <code class="docutils literal notranslate"><span class="pre">xtc</span></code>
trajectories in it and a <code class="docutils literal notranslate"><span class="pre">pdb</span></code> topology file named <code class="docutils literal notranslate"><span class="pre">fs-peptide.pdb</span></code>.
Feel free to load one of these trajectories in VMD to get a sense of
what they look like. Ensure that the symlinks <code class="docutils literal notranslate"><span class="pre">top.pdb</span></code> and <code class="docutils literal notranslate"><span class="pre">trajs</span></code>
resolve to the correct place. We use symlinks to map <em>your</em> filenames
to into “standard” msmbuilder names. For example,
if your set of trajectories was stored on another partition, you could
use a symlink to point to the folder, name it <code class="docutils literal notranslate"><span class="pre">trajs</span></code>, and the scripts
will work without modification.</p>
</li>
<li><p>Begin our analysis:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>analysis/
</pre></div>
</div>
</li>
<li><p>We first generate a list of our trajectories and associated metadata.
Examine the <code class="docutils literal notranslate"><span class="pre">gather-metadata.py</span></code> script. Note that it uses the <code class="docutils literal notranslate"><span class="pre">xtc</span></code>
filenames to generate an integer key for each trajectory. The script
also extracts the length of each trajectory and stores the xtc filename:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>gather-metadata.py
python<span class="w"> </span>gather-metadata-plot.py
</pre></div>
</div>
<figure class="align-right" id="id3">
<img alt="_images/lengths-hist.png" src="_images/lengths-hist.png" />
<figcaption>
<p><span class="caption-text">Sometimes you’ll have many different length-ed trajectories and
this histogram will be interesting. All of our trajectories are 500 ns
though.</span><a class="headerlink" href="#id3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The plot script contains several example functions of computing statistics
on your dataset including aggregate length. It will also generate an <code class="docutils literal notranslate"><span class="pre">html</span></code>
rendering of the table of metadata. <strong>Exercise:</strong> modify the
script to genereate <code class="docutils literal notranslate"><span class="pre">png</span></code> images intead of <code class="docutils literal notranslate"><span class="pre">pdf</span></code> vector graphics for
the plots. Editor’s note: use <code class="docutils literal notranslate"><span class="pre">pdf</span></code> for preperation of manuscripts
because you can
<a class="reference external" href="https://en.wikipedia.org/wiki/Vector_graphics">infinitely resize</a> your plots.</p>
</li>
<li><p>We’ll start reducing the dimensionality of our dataset by transforming
the raw Cartesian coordinates into biophysical “features”. We’ll use
dihedral angles. The templated project also includes subfolders <code class="docutils literal notranslate"><span class="pre">landmarks</span></code>
and <code class="docutils literal notranslate"><span class="pre">rmsd</span></code> for alternative approaches, but we’ll ignore those for now:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>dihedrals/
</pre></div>
</div>
</li>
<li><p>Examine the <code class="docutils literal notranslate"><span class="pre">featurize.py</span></code> script. Note that it loops through our trajectories
using the convenience function <code class="docutils literal notranslate"><span class="pre">itertrajs</span></code> (which only ever holds one
trajectory in RAM) and calls <code class="docutils literal notranslate"><span class="pre">DihedralFeaturizer.partial_transform()</span></code>
on each. Read more about <a class="reference internal" href="featurization.html#featurization"><span class="std std-ref">featurizers</span></a> and MSMBuilder
<a class="reference internal" href="apipatterns.html#apipatterns"><span class="std std-ref">API patterns</span></a>. Run the scripts:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>featurize.py
python<span class="w"> </span>featurize-plot.py
</pre></div>
</div>
<p>The plots will show you a box and whisker plot of each feature value. This
is not very useful, but we wanted to make sure you can plot something
for each step.
<strong>Exercise:</strong> include <a class="reference external" href="https://swissmodel.expasy.org/course/text/chapter3.htm">chi1 and chi2</a>
angles in addition to the default <a class="reference external" href="https://en.wikipedia.org/wiki/Ramachandran_plot">phi and psi</a>
angles.</p>
</li>
<li><p>Dihedrals are too numerous to be interpretable. We can use <a class="reference internal" href="decomposition.html#decomposition"><span class="std std-ref">tica</span></a>
to learn a small number of “kinetic coordinates” from our data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>tica/
</pre></div>
</div>
</li>
<li><p>Examine <code class="docutils literal notranslate"><span class="pre">tica.py</span></code>. Note that it loads the feature trajectories, learns
a model from them by calling <code class="docutils literal notranslate"><span class="pre">fit()</span></code> and then transforms the feature trajectories
into “tica trajectories” by calling <code class="docutils literal notranslate"><span class="pre">partial_transform()</span></code>
on each (see <a class="reference internal" href="apipatterns.html#apipatterns"><span class="std std-ref">api patterns</span></a>). The MSMBuilder API <em>does not</em>
keep track of units. Our data was saved every 50 ps (Editor’s note: this is
way too frequent for a “real” simulation). The template script for learning
our tica model sets the <code class="docutils literal notranslate"><span class="pre">lag_time</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">10</span></code>. This means 10 steps
in our data. This translates to 500 ps here. Let’s use something a little
longer like 5 ns (= 100 steps). Edit the <code class="docutils literal notranslate"><span class="pre">lag_time</span></code> parameter to 100 and
learn the model:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim<span class="w"> </span>tica.py<span class="w"> </span><span class="c1"># edit lag_time -&gt; 100</span>
python<span class="w"> </span>tica.py
python<span class="w"> </span>tica-plot.py
</pre></div>
</div>
</li>
<li><figure class="align-right" id="id4">
<img alt="_images/tica-heatmap.png" src="_images/tica-heatmap.png" />
<figcaption>
<p><span class="caption-text">tICA heatmaps provide a convenient 2d projection of your data
onto which you can overlay more interesting info.</span><a class="headerlink" href="#id4" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The tICA plotting script makes a 2d histogram of our data. Note the apparent
free energy well on the left of the figure. We might suspect that this is
the folded state and the x-axis is an unfolding coordinate. We’ll use
this tica heatmap as a background for our further plots. tICA is extremely
useful at taking hundreds of dihedral angles (for example) and distilling it
into a handful of coordinates that we can plot.</p>
</li>
<li><p>We can sample configurations along a tIC to inspect what that tIC “means”.
Another common strategy for interpreting tICs is to inspect prominent
(most non-zero) coefficients corresponding to particular features (dihedrals).
A common tactic is to color residues based on their tIC loading. Example
scripts to set up VMD for this will be included in a later release. Here,
we simply draw configurations along a tIC direction:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>tica-sample-coordinate.py
python<span class="w"> </span>tica-sample-coordinate-plot.py
</pre></div>
</div>
</li>
<li><figure class="align-right" id="id5">
<img alt="_images/tica-movie.gif" src="_images/tica-movie.gif" />
<figcaption>
<p><span class="caption-text">The first tIC is roughly a folding coordinate.</span><a class="headerlink" href="#id5" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>This produces a trajectory of conformations, saved as <code class="docutils literal notranslate"><span class="pre">tica-dimension-0.xtc</span></code>.
<strong>Exercise:</strong> Save the conformations as a <code class="docutils literal notranslate"><span class="pre">dcd</span></code> trajectory instead.
You can load this trajectory in VMD and inspect the particular tIC:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>top.pdb<span class="w"> </span>tica-dimension-0.xtc
</pre></div>
</div>
<p>Align the structures and apply some “smoothing”.
<strong>Exercise:</strong> Sample the second tIC. Note that it probably isn’t an
interesting coordinate in this case.</p>
</li>
<li><p>We can group conformations that interconvert rapidly by using off-the-shelf
clustering algorithms on our kinetic coordinates (tICs):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>cluster/
</pre></div>
</div>
<p>By default, we generate 500 clusters using a form of KMeans. Read more
about <a class="reference internal" href="cluster.html#cluster"><span class="std std-ref">clustering</span></a>.
<strong>Exercise:</strong> try a different number of clusters or a different
clustering algorithm. Run the clustering scripts:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>cluster.py
python<span class="w"> </span>cluster-plot.py
</pre></div>
</div>
<p>Note that the tIC heatmap provides a convenient space onto which we project
our cluster centers.</p>
</li>
<li><p>With our states defined, we count the transitions between them. An <a class="reference internal" href="msm.html#msm"><span class="std std-ref">MSM</span></a>
is simply states and rates. First we make a “microstate” MSM consisting
of many, small states:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>msm/
</pre></div>
</div>
</li>
<li><figure class="align-right" id="id6">
<img alt="_images/msm-microstates.png" src="_images/msm-microstates.png" />
<figcaption>
<p><span class="caption-text">The microstate centers are shown as circles on the tIC heatmap.
They are sized according to state population. They are colored
according to the first dynamical eigenvector. The slowest
processes is a transition from red states to blue.</span><a class="headerlink" href="#id6" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The MSM lag-time is a parameter that cannot be optimized using <a class="reference internal" href="gmrq.html#gmrq"><span class="std std-ref">gmrq</span></a>.
You can use the <code class="docutils literal notranslate"><span class="pre">timescales.py</span></code> script to check how the model timescales
would react to changing the lag-time. We’ll just use a lag-time of 5 ns.
Remember from above that we have to keep track of units. 5 ns is 100 steps.
Edit <code class="docutils literal notranslate"><span class="pre">microstate.py</span></code> and set <code class="docutils literal notranslate"><span class="pre">lag_time</span> <span class="pre">=</span> <span class="pre">100</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim<span class="w"> </span>microstate.py<span class="w"> </span><span class="c1"># edit lag_time</span>
python<span class="w"> </span>microstate.py
python<span class="w"> </span>microstate-plot.py
</pre></div>
</div>
</li>
<li><p>Generate a sample trajectory from the MSM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>microstate-traj.py
</pre></div>
</div>
<p>By default, each frame will be 1 lag-time unit. Here, that is 5 ns.
<strong>Exercise:</strong> Use the <code class="docutils literal notranslate"><span class="pre">n_steps</span></code> and <code class="docutils literal notranslate"><span class="pre">stride</span></code> parameter to sample
a 200 frame movie with 50 ns steps.
You can load the trajectory in VMD and watch the Fs-peptide stochastically
fold and unfold:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vmd<span class="w"> </span>top.pdb<span class="w"> </span>msm-traj.xtc
</pre></div>
</div>
</li>
</ol>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="examples/index.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, Stanford University and the Authors.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
    var versions_json_url = 'http://msmbuilder.org/versions.json'
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        3.8.6
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>